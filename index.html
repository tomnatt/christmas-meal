<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <!-- <meta http-equiv="refresh" content="5"> -->
</head>
<body>
<svg
   xmlns:osb="http://www.openswatchbook.org/uri/2009/osb"
   xmlns:dc="http://purl.org/dc/elements/1.1/"
   xmlns:cc="http://creativecommons.org/ns#"
   xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
   xmlns:svg="http://www.w3.org/2000/svg"
   xmlns="http://www.w3.org/2000/svg"
   xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd"
   xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"
   version="1.0"
   x="0px"
   y="0px"
   width="2304px"
   height="1152px"
   xml:space="preserve"
   class="chart"
   id="svg2"
   inkscape:version="0.48.4 r9939"
   sodipodi:docname="holly_leaves.svg"><metadata
     id="metadata22"><rdf:RDF><cc:Work
         rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type
           rdf:resource="http://purl.org/dc/dcmitype/StillImage" /><dc:title></dc:title></cc:Work></rdf:RDF></metadata><defs
     id="defs20"><linearGradient
       id="linearGradient5775"
       osb:paint="solid"><stop
         style="stop-color:#ff8540;stop-opacity:1;"
         offset="0"
         id="stop5777" /></linearGradient></defs><sodipodi:namedview
     pagecolor="#ffffff"
     bordercolor="#666666"
     borderopacity="1"
     objecttolerance="10"
     gridtolerance="10"
     guidetolerance="10"
     inkscape:pageopacity="0"
     inkscape:pageshadow="2"
     inkscape:window-width="1125"
     inkscape:window-height="715"
     id="namedview18"
     showgrid="false"
     inkscape:zoom="0.83972969"
     inkscape:cx="446.137"
     inkscape:cy="880.74319"
     inkscape:window-x="84"
     inkscape:window-y="24"
     inkscape:window-maximized="0"
     inkscape:current-layer="&lt;Group&gt;-4" /><g
     id="g3809"
     transform="matrix(1.3493299,0,0,1.3308876,81.411035,-151.92655)"><path
       sodipodi:nodetypes="cccc"
       inkscape:connector-curvature="0"
       id="path5789"
       d="m 607.30863,151.07435 c -108.46489,26.56194 -242.59267,74.76432 -251.783,82.91633 -44.12097,43.62107 -16.13345,51.5561 -50.92642,70.79136 -73.03714,40.20518 -113.35927,29.41092 -272.546132,108.78191"
       style="fill:none;stroke:#734f15;stroke-width:13;stroke-linecap:round;stroke-linejoin:miter;stroke-miterlimit:4;stroke-opacity:1;stroke-dasharray:none" /><path
       sodipodi:nodetypes="cccc"
       inkscape:connector-curvature="0"
       id="path3807"
       d="m 558.51064,163.70213 c -33.33333,11.33743 -40.07092,35.79807 -40.42553,48.93617 3.96424,49.78471 20.51331,23.08275 21.27659,67.02127 -9.0974,24.73705 -10.11187,20.11302 -25.53191,36.17021"
       style="fill:none;stroke:#734f15;stroke-width:13;stroke-linecap:round;stroke-linejoin:miter;stroke-miterlimit:4;stroke-opacity:1;stroke-dasharray:none" /></g><g
     id="Layer 109-1"
     transform="matrix(-1.280212,-0.50785624,0.50785624,-1.280212,543.82052,652.74001)"><g
       id="&lt;Group&gt;-0"><g
         id="Layer 138-6"><path
           style="fill:#00dd00"
           d="m 127.063,214.719 c -1.334,6.862 -5.81,12.161 -9.907,17.5 0.375,4.48 -1.554,8.467 -5.312,11.187 -0.667,1.998 -7.214,3.22 -2.969,4.969 6.349,5.692 -0.797,14.017 -4.25,18.594 4.941,-1.009 7.393,5.062 3.781,8.343 -2.667,4.137 -12.6722,5.733 -12.2497,-1.218 0.5863,-5.53 -7.2456,0.498 -10.9375,-0.594 -4.7328,0.466 -6.867,-4.879 -7.5938,-8 -4.7427,3.477 -12.217,7.287 -17.4063,3 -6.7362,2.452 -13.8511,2.535 -20.9374,2.594 3.0914,3.684 7.4558,9.003 4.5625,14.343 2.516,1.166 6.9179,1.796 5.125,6 -0.6664,2.269 -2.7632,5.619 1.5,4.782 5.2634,0.704 6.5026,8.08 6.0625,11.844 4.5243,-1.918 10.6791,-8.461 14.6875,-2.032 3.1599,1.558 4.5093,12.052 6.5609,8.561 1.0939,-5.174 7.3208,-10.088 11.6891,-4.936 2.8482,1.86 4.4089,6.579 6.7187,8.031 4.7965,-4.598 9.8775,-10.368 17.3435,-9 1.886,0.054 8.611,1.123 4.407,-2.218 -10.666,-12.237 -25.6545,-19.2 -41.1474,-23.095 -5.4164,-1.777 -11.7456,-2.943 -16.6343,-5.186 15.4997,3.615 31.6113,6.7 45.7817,14.25 5.62,2.802 9.785,9.263 14.906,11.687 -0.529,-1.594 -1.077,-5.613 1.656,-3.094 5.003,5.25 0.814,-2.233 0.219,-4.593 -5.957,-18.119 -1.419,-37.586 1.875,-55.782 1.889,-7.94 1.007,0.246 0.349,3.426 -3.116,19.574 -6.764,41.813 4.401,59.543 3.993,-0.459 2.792,-6.217 3.25,-8.031 2.529,2.345 0.96,7.473 2.687,9.375 6.719,-9.844 15.58,-18.175 26.61,-23.017 9.441,-4.513 20.111,-9.809 29.484,-12.389 -19.541,9.942 -43.03,17.383 -54.187,37.937 -3.587,4.491 4.842,3.107 6.562,1.406 6.335,-4.765 12.591,2.807 17.438,6.032 2.167,-4.652 4.416,-11.189 10.156,-12.844 4.103,-0.258 7.613,9.087 9.237,5.106 1.392,-5.35 4.621,-15.296 11.982,-11.012 7.195,5.959 4.98,-1.035 6.468,-6.438 0.772,-3.512 4.63,-3.328 6.969,-4.344 -1.378,-2.788 -5.355,-8.271 -0.344,-9.906 4.519,-0.74 -1.279,-5.578 0.688,-8.312 1.627,-5.844 6.367,-9.919 -2.438,-6.876 -5.181,0.976 -10.7,-0.667 -15.625,-0.468 -1.292,5.287 -9.152,3.033 -12.843,1.75 -1.856,-1.211 -5.407,-2.444 -4.344,1.312 -1.668,8.677 -11.555,5.068 -17.25,6.344 2.243,4.15 -1.063,8.823 -5.875,7.562 -4.054,0.755 -9.187,-2.71 -5.531,-6.718 1.846,-4.446 14.073,-0.931 9.065,-5.182 -3.689,-3.712 -9.759,-10.631 -3.44,-15.006 1.24,-2.361 4.581,-2.227 6.031,-3.531 -3.16,-3.524 -10.86,-6.614 -7.656,-12.625 -0.638,-3.512 -8.696,-1.173 -8.063,-6.375 1.811,-2.983 -0.683,-3.579 -3.094,-3.75 -4.292,-1.351 -5.2,-6.839 -8.218,-8.906"
           id="path7-4"
           inkscape:connector-curvature="0" /></g></g></g><g
     id="&lt;Group&gt;"
     transform="matrix(0.13702984,-1.45011,1.45011,0.13702984,-123.07172,440.29935)"><g
       id="Layer 138"><path
         inkscape:connector-curvature="0"
         id="path7"
         d="m 127.063,214.719 c -1.334,6.862 -5.81,12.161 -9.907,17.5 0.375,4.48 -1.554,8.467 -5.312,11.187 -0.667,1.998 -7.214,3.22 -2.969,4.969 6.349,5.692 -0.797,14.017 -4.25,18.594 4.941,-1.009 7.393,5.062 3.781,8.343 -2.667,4.137 -12.6722,5.733 -12.2497,-1.218 0.5863,-5.53 -7.2456,0.498 -10.9375,-0.594 -4.7328,0.466 -6.867,-4.879 -7.5938,-8 -4.7427,3.477 -12.217,7.287 -17.4063,3 -6.7362,2.452 -13.8511,2.535 -20.9374,2.594 3.0914,3.684 7.4558,9.003 4.5625,14.343 2.516,1.166 6.9179,1.796 5.125,6 -0.6664,2.269 -2.7632,5.619 1.5,4.782 5.2634,0.704 6.5026,8.08 6.0625,11.844 4.5243,-1.918 10.6791,-8.461 14.6875,-2.032 3.1599,1.558 4.5093,12.052 6.5609,8.561 1.0939,-5.174 7.3208,-10.088 11.6891,-4.936 2.8482,1.86 4.4089,6.579 6.7187,8.031 4.7965,-4.598 9.8775,-10.368 17.3435,-9 1.886,0.054 8.611,1.123 4.407,-2.218 -10.666,-12.237 -25.6545,-19.2 -41.1474,-23.095 -5.4164,-1.777 -11.7456,-2.943 -16.6343,-5.186 15.4997,3.615 31.6113,6.7 45.7817,14.25 5.62,2.802 9.785,9.263 14.906,11.687 -0.529,-1.594 -1.077,-5.613 1.656,-3.094 5.003,5.25 0.814,-2.233 0.219,-4.593 -5.957,-18.119 -1.419,-37.586 1.875,-55.782 1.889,-7.94 1.007,0.246 0.349,3.426 -3.116,19.574 -6.764,41.813 4.401,59.543 3.993,-0.459 2.792,-6.217 3.25,-8.031 2.529,2.345 0.96,7.473 2.687,9.375 6.719,-9.844 15.58,-18.175 26.61,-23.017 9.441,-4.513 20.111,-9.809 29.484,-12.389 -19.541,9.942 -43.03,17.383 -54.187,37.937 -3.587,4.491 4.842,3.107 6.562,1.406 6.335,-4.765 12.591,2.807 17.438,6.032 2.167,-4.652 4.416,-11.189 10.156,-12.844 4.103,-0.258 7.613,9.087 9.237,5.106 1.392,-5.35 4.621,-15.296 11.982,-11.012 7.195,5.959 4.98,-1.035 6.468,-6.438 0.772,-3.512 4.63,-3.328 6.969,-4.344 -1.378,-2.788 -5.355,-8.271 -0.344,-9.906 4.519,-0.74 -1.279,-5.578 0.688,-8.312 1.627,-5.844 6.367,-9.919 -2.438,-6.876 -5.181,0.976 -10.7,-0.667 -15.625,-0.468 -1.292,5.287 -9.152,3.033 -12.843,1.75 -1.856,-1.211 -5.407,-2.444 -4.344,1.312 -1.668,8.677 -11.555,5.068 -17.25,6.344 2.243,4.15 -1.063,8.823 -5.875,7.562 -4.054,0.755 -9.187,-2.71 -5.531,-6.718 1.846,-4.446 14.073,-0.931 9.065,-5.182 -3.689,-3.712 -9.759,-10.631 -3.44,-15.006 1.24,-2.361 4.581,-2.227 6.031,-3.531 -3.16,-3.524 -10.86,-6.614 -7.656,-12.625 -0.638,-3.512 -8.696,-1.173 -8.063,-6.375 1.811,-2.983 -0.683,-3.579 -3.094,-3.75 -4.292,-1.351 -5.2,-6.839 -8.218,-8.906"
         style="fill:#00dd00" /></g></g><g
     id="Layer 109-0"
     transform="matrix(-0.92996649,-0.97868433,0.97868433,-0.92996649,36.745359,849.54506)"><g
       id="&lt;Group&gt;-4"
       transform="matrix(0.94258961,-0.33395333,0.33395333,0.94258961,-38.723749,42.612404)"><g
         id="Layer 138-2"><path
           style="fill:#00dd00"
           d="m 127.063,214.719 c -1.334,6.862 -5.81,12.161 -9.907,17.5 0.375,4.48 -1.554,8.467 -5.312,11.187 -0.667,1.998 -7.214,3.22 -2.969,4.969 6.349,5.692 -0.797,14.017 -4.25,18.594 4.941,-1.009 7.393,5.062 3.781,8.343 -2.667,4.137 -12.6722,5.733 -12.2497,-1.218 0.5863,-5.53 -7.2456,0.498 -10.9375,-0.594 -4.7328,0.466 -6.867,-4.879 -7.5938,-8 -4.7427,3.477 -12.217,7.287 -17.4063,3 -6.7362,2.452 -13.8511,2.535 -20.9374,2.594 3.0914,3.684 7.4558,9.003 4.5625,14.343 2.516,1.166 6.9179,1.796 5.125,6 -0.6664,2.269 -2.7632,5.619 1.5,4.782 5.2634,0.704 6.5026,8.08 6.0625,11.844 4.5243,-1.918 10.6791,-8.461 14.6875,-2.032 3.1599,1.558 4.5093,12.052 6.5609,8.561 1.0939,-5.174 7.3208,-10.088 11.6891,-4.936 2.8482,1.86 4.4089,6.579 6.7187,8.031 4.7965,-4.598 9.8775,-10.368 17.3435,-9 1.886,0.054 8.611,1.123 4.407,-2.218 -10.666,-12.237 -25.6545,-19.2 -41.1474,-23.095 -5.4164,-1.777 -11.7456,-2.943 -16.6343,-5.186 15.4997,3.615 31.6113,6.7 45.7817,14.25 5.62,2.802 9.785,9.263 14.906,11.687 -0.529,-1.594 -1.077,-5.613 1.656,-3.094 5.003,5.25 0.814,-2.233 0.219,-4.593 -5.957,-18.119 -1.419,-37.586 1.875,-55.782 1.889,-7.94 1.007,0.246 0.349,3.426 -3.116,19.574 -6.764,41.813 4.401,59.543 3.993,-0.459 2.792,-6.217 3.25,-8.031 2.529,2.345 0.96,7.473 2.687,9.375 6.719,-9.844 15.58,-18.175 26.61,-23.017 9.441,-4.513 20.111,-9.809 29.484,-12.389 -19.541,9.942 -43.03,17.383 -54.187,37.937 -3.587,4.491 4.842,3.107 6.562,1.406 6.335,-4.765 12.591,2.807 17.438,6.032 2.167,-4.652 4.416,-11.189 10.156,-12.844 4.103,-0.258 7.613,9.087 9.237,5.106 1.392,-5.35 4.621,-15.296 11.982,-11.012 7.195,5.959 4.98,-1.035 6.468,-6.438 0.772,-3.512 4.63,-3.328 6.969,-4.344 -1.378,-2.788 -5.355,-8.271 -0.344,-9.906 4.519,-0.74 -1.279,-5.578 0.688,-8.312 1.627,-5.844 6.367,-9.919 -2.438,-6.876 -5.181,0.976 -10.7,-0.667 -15.625,-0.468 -1.292,5.287 -9.152,3.033 -12.843,1.75 -1.856,-1.211 -5.407,-2.444 -4.344,1.312 -1.668,8.677 -11.555,5.068 -17.25,6.344 2.243,4.15 -1.063,8.823 -5.875,7.562 -4.054,0.755 -9.187,-2.71 -5.531,-6.718 1.846,-4.446 14.073,-0.931 9.065,-5.182 -3.689,-3.712 -9.759,-10.631 -3.44,-15.006 1.24,-2.361 4.581,-2.227 6.031,-3.531 -3.16,-3.524 -10.86,-6.614 -7.656,-12.625 -0.638,-3.512 -8.696,-1.173 -8.063,-6.375 1.811,-2.983 -0.683,-3.579 -3.094,-3.75 -4.292,-1.351 -5.2,-6.839 -8.218,-8.906"
           id="path7-1"
           inkscape:connector-curvature="0" /></g></g></g></svg>

<div id="course_information"></div>

<style>

.chart {
    border: 1px solid black;
    width: 900px;
    height: 530px;
    background:url('WinterChristmasSceneVectorIllustration2.jpg') no-repeat;
    position: absolute;
    top: 0;
    left: 0;
}
.chart circle {
    cursor: pointer;
}
.food_info {
    display: none;
    background-color: red;
    border: thin black solid;
    margin-left: 3px;
    padding: 0 10px;
    position: absolute;
}

</style>
<script src="//d3js.org/d3.v3.min.js"></script>
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
<script>

// scaling
var radius_scale = 5;
// starter berries position
var starter_x = 170;
var starter_y = 380;
// main berries position
var main_x = 375;
var main_y = 295;
// dessert berries position
var dessert_x = 550;
var dessert_y = 180;

var starter = {};
var main = {};
var dessert = {};
var chart = d3.select(".chart");

$.getJSON("data.json", function(data) {

    // load the data
    $.each(data["person"], function(i, v) {
        
        // starters
        if (v["starter"] in starter) {
            starter[v["starter"]].push(v["name"]);
        } else {
            starter[v["starter"]] = [v["name"]];
        }

        // mains
        if (v["main"] in main) {
            main[v["main"]].push(v["name"]);
        } else {
            main[v["main"]] = [v["name"]];
        }

        // desserts
        if (v["dessert"] in dessert) {
            dessert[v["dessert"]].push(v["name"]);
        } else {
            dessert[v["dessert"]] = [v["name"]];
        }

    });

    createBerries("starter", starter_x, starter_y, starter);
    addCourseDataToPage("starter", starter);

    createBerries("main", main_x, main_y, main);
    addCourseDataToPage("main", main);

    createBerries("dessert", dessert_x, dessert_y, dessert);
    addCourseDataToPage("dessert", dessert);

    enableMouseInteraction();

    // 3 random berries flash every 5 seconds
    setInterval(function() {
        berryPulse();
        setTimeout(berryPulse, 500);
        setTimeout(berryPulse, 1000);
    }, 5000);

});

function createBerries(course, course_x, course_y, course_data) {

    // pull out the needed data
    var course_keys = Object.keys(course_data);
    var course_values = Object.keys(course_data).map(function(v) { return course_data[v].length; });
    var max_course_value = Math.max.apply(Math, course_values);

    var circles = chart.selectAll("circle." + course)
        .data(course_keys)
        .enter().append("circle")
        // space the circles around a point
        .attr("cx", function(d, i) { 
            var x_shift = Math.sin(i * (2 * Math.PI / course_keys.length)) * (max_course_value * radius_scale);
            return course_x + x_shift;
        })
        .attr("cy", function(d, i) { 
            var y_shift = Math.cos(i * (2 * Math.PI / course_keys.length)) * (max_course_value * radius_scale);
            return course_y + y_shift;
        })
        .attr("r", function(d, i) { return course_data[d].length * radius_scale; })
        .attr("fill", "red")
        .attr("id", function(d, i) { return course + "_" + generateId(d); })
        .attr("class", course);
}

function addCourseDataToPage(course, course_data) {

    $.each(Object.keys(course_data), function(key, noms) {

        // the people who ordered it
        var people = "";
        $.each(course_data[noms], function(key, person) {
            people += "<li>" + person + "</li>";
        });

        // the display
        var circle_id = course + "_" + generateId(noms);
        var id = circle_id + "_data";
        var html = "<div class=\"food_info\" id=\"" + id + "\">" 
                    + "<h3>" + noms + "</h3>"
                    + "<ul>"
                    + people
                    + "</ul>"
                    + "</div>";

        // add it
        $("#course_information").append(html);
        // and style it
        var c = d3.select("#" + circle_id);
        var t = parseFloat(c.attr("cy"));
        var l = parseFloat(c.attr("cx")) + parseFloat(c.attr("r"));

        $("#" + id).css("top", t + "px")
                    .css("left", l + "px");
    });

}

function enableMouseInteraction() {

    d3.selectAll("circle").on("mouseover", function() {
        // change colour and display the data
        var c = d3.select(this);
        c.transition().duration(250).style("fill", "#ff7709");
        $("#"+c.attr("id")+"_data").show();
    });
    d3.selectAll("circle").on("mouseout", function() {
        // revert the colour and hide the data again
        var c = d3.select(this);
        c.transition().duration(500).style("fill", "red");
        $("#"+c.attr("id")+"_data").hide();
    });

}

function berryPulse() {
    var circles = d3.selectAll("circle");
    var i = Math.floor(Math.random() * circles[0].length);
    d3.select(circles[0][i]).transition().duration(250).style("fill", "#ff7709")
         .transition().duration(500).style("fill", "red");
}

function generateId(data) {
    return data.replace(/ /g,"_").replace(/'/g,"").toLowerCase()
}

</script>
</body>
</html>